{% extends 'base.html' %}
{% load static %}
{% block title %}Meu Anúncio: {{anuncio.modelo}}{% endblock %}
{%block content%}
<div class="adm-bg">
  <div id="moldura">
    <div class="table-responsive-sm">
      <table class="table table-striped table-borderless">
        <thead>
          <tr>
            <th scope="col" class="table-dark h5 text-center">{{anuncio.marca}} - {{anuncio.modelo}} | R$
              {{anuncio.valor}}
            </th>
          </tr>
        </thead>
      </table>
    </div>
    {% if messages %}
    <ul class="messages">
      {% for message in messages %}
      <li {% if message.tags %} class="alert alert-warning" role="alert"> {% endif %} {{ message }} </li>
      {% endfor %}
    </ul>
    {% endif %}
    <div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
      <div class="carousel-inner">
        <div class="carousel-item active">
          {% if anuncio.image %}
          <img src="/media/{{anuncio.image}}" class="d-block w-100" height="500px" alt="foto">
          {%else%}
          <img src="{% static 'img/sem-foto.jpg' %}" class="d-block w-100" height="500px" alt="foto">
          {%endif%}
          <div class="carousel-caption d-none d-md-block">
            <h5 class="text-white">{{anuncio.marca}} {{anuncio.modelo}}</h5>
            <p class="text-white">Diária: R$ {{anuncio.valor}}</p>
          </div>
        </div>
        {%for i in img%}
        <div class="carousel-item">
          <img src="/media/{{i.image}}" class="d-block w-100" height="500px" alt="foto">
          <div class="carousel-caption d-none d-md-block">
            <h5 class="text-white">{{anuncio.marca}} {{anuncio.modelo}}</h5>
            <p class="text-white">Diária: R$ {{anuncio.valor}}</p>
          </div>
        </div>
        {%endfor%}
      </div>
      <a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div><br>
    <form class="" action={% url 'anuncio-editar' anuncio.slug2 %} method="GET">
      <div class="table-responsive-sm">
        <table class="table table-striped table-borderless">
          <tbody>
            <tr>
              <td><strong>Ano</strong><br>{{anuncio.ano}}</td>
              <td><strong>Cambio</strong><br>{{anuncio.cambio}}</td>
              <td><strong>Combustível</strong><br>{{anuncio.combustivel}}</td>
              <td><strong>Kit Gás</strong><br>{%if anuncio.gas%}Sim{%else%}Não{%endif%}</td>
              <td><strong>Seguro</strong><br>{%if anuncio.seguro%}Sim{%else%}Não{%endif%}</td>
            </tr>
            <tr>
              <td><strong>Contato</strong><br>{{anuncio.nome}}</td>
              <td><strong>Email</strong><br>{{anuncio.email}}</td>
              <td><strong>Telefone</strong><br>{{anuncio.telefone}}</td>
              <td><strong>Cidade</strong><br>{{anuncio.local_municipio}} - {{anuncio.local_uf}}</td>
              <td><strong>&nbsp;</strong><br>&nbsp;</td>
            </tr>
            {%if anuncio.comentario%}
            <tr>
              <td colspan="5"><strong>Comentário</strong><br><i>"{{anuncio.comentario}}"</i></td>
            </tr>
            {%endif%}
          </tbody>
        </table>
      </div>
      <div class="form-group text-center">
        <button type="submit" value="Editar" class="btn btn-dark">Editar</button>
        <button type="button" class="btn btn-dark" onclick="location.href = '/anuncio/lista';">Meus Anúncios</button>
        <button type="button" class="btn btn-dark" onclick="location.href = '/anuncio/fotos/{{anuncio.slug2}}';">Inserir
          Fotos</button>
        <button class="btn btn-dark" type="button" data-toggle="collapse" data-target="#collapseExample"
          aria-expanded="true" aria-controls="collapseExample">
          Conversas ({{total}})
        </button>
        <button type="button" class="btn btn-dark"
          onclick="location.href = '/anuncio/ativar/{{anuncio.slug2}}';">Ativar</button>
      </div>
    </form>

    <div class="collapse" id="collapseExample">

      <br>
      {%for conversa in conversas%}
      <div>
        {%if msgs%}<i><b>{{conversa.motorista_nome}}&nbsp;{{conversa.motorista_sobrenome}}:</b></i>{%endif%}
        {%for msg in msgs%}
        {%if msg.motorista_id == conversa.motorista_id%}
          {%if msg.motorista_id == msg.criador%}
            <div class="msgmotorista">
              {{msg.mensagem}}
              <p><i>{{msg.motorista_nome}}, {{msg.created_at|date:"d/m/Y"}}&nbsp;{{msg.created_at|time:"H:i"}}</i></p>
            </div>
          {%else%}
          <div class="msgproprietario">
            {{msg.mensagem}}
            <p><i>{{msg.proprietario_nome}}, {{msg.created_at|date:"d/m/Y"}}&nbsp;{{msg.created_at|time:"H:i"}}</i></p>
          </div>
          {%endif%}
        {%endif%}
        {%endfor%}
        <p><i>Mensagem/Resposta:</i></p>
        <form method="post">
          {% csrf_token %}
          <input type="hidden" value="{{anuncio.id}}" name="anuncio_id" id="anuncio_id">
          <input type="hidden" value="{{conversa.motorista_id}}" name="motorista_id" id="motorista_id">
          <input type="hidden" value="{{conversa.motorista_nome}}" name="motorista_nome" id="motorista_nome">
          <input type="hidden" value="{{conversa.motorista_sobrenome}}" name="motorista_sobrenome" id="motorista_sobrenome">
          <input type="hidden" value="{{anuncio.slug2}}" name="nome" id="nome">
          <input type="hidden" value="{{conversa.id}}" name="conversa_id" id="conversa_id">
          <textarea id="mensagem" name="mensagem" style="width:100%"></textarea><br>
          <button type="submit" class="btn btn-dark">Enviar Mensagem Para {{conversa.motorista_nome}}</button>
        </form><br>
      </div>
      {%endfor%}


    </div>

  </div>
</div>
</div>

{%endblock%}